from random import randint
from tkinter import *
import tkinter as tk
from tkinter import ttk
from tkinter.messagebox import showerror, showwarning, showinfo
from tkinter import filedialog as fd
from llama_cpp import Llama
from os import system
from interpreter import FilmPlayer
path = None
def select_file():
    filetypes = (
        ('.gguf files', '*.gguf'),
        ('All files (not recommended)', '*.*')
    )
    path = fd.askopenfilename(
        title='Open a file',
        initialdir='/',
        filetypes=filetypes)
    with open("filename.conf", "w") as file:
        file.write(path)
    print(path)
def start():
    global path
    try:
        file = open('filename.conf', 'r')
        path = file.read()
        if path == "":
            showerror(title="–ü—É—Ç—å –ø—É—Å—Ç–æ–π", message="–í—ã –Ω–∞–∂–∞–ª–∏ –Ω–∞ \"–û—Ç–º–µ–Ω–∞\" –≤ —Ñ–∞–π–ª–æ–≤–æ–º –¥–∏–∞–ª–æ–≥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å.")
            return
    except FileNotFoundError:
        showerror(title="–ü—É—Ç—å –Ω–µ —É–∫–∞–∑–∞–Ω", message="–£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å")
        return
    p = editor.get("1.0", "end")
    generation_window = tk.Toplevel(root)
    generation_window.title("–ü–æ–¥–æ–∂–¥–∏—Ç–µ!")
    generation_window.geometry("300x75")
    generation_window.iconbitmap(r'Fakefilms_icon.ico')
    generation_window.resizable(False, False)
    text = Label(generation_window, text="–ù–µ–π—Ä–æ—Å–µ—Ç—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥. \n –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.\n–ü–æ–º–Ω–∏, –Ω–µ–π—Ä–æ—Å–µ—Ç—å –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è, –ø–æ—ç—Ç–æ–º—É\n–µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç, —Ç–æ –≤–∏–Ω–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç—å")
    text.grid()
    generation_window.update()
    instruction = """–¥–∞—é —Ç–µ–±–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –º–æ–µ–º—É —è–∑—ã–∫—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—ã –±—É–¥–µ—à—å –¥–µ–ª–∞—Ç—å —Ñ–∏–ª—å–º—ã
    –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –¥—Ä—É–≥–∏–µ –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π, –∏–Ω–∞—á–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É

    title (–Ω–∞–∑–≤–∞–Ω–∏–µ) - —Å—Ç–µ—Ä–µ—Ç—å –≤—Å—ë –∏ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
    –ø—Ä–∏–º–µ—Ä: title test

    sleep (—Å–µ–∫—É–Ω–¥—ã) - –ø–æ–¥–æ–∂–¥–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ —Å–µ–∫—É–Ω–¥—ã
    –ø—Ä–∏–º–µ—Ä: sleep 1 - –∂–¥–∞—Ç—å 1 —Å–µ–∫—É–Ω–¥—É

    rem (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π) - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, —ç—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
    –ø—Ä–∏–º–µ—Ä: rem —ã–≤–∞—Ñ—ã–æ–≤–∞—Ñ–æ—ã–≤—Ä—ã–≤—Ä –∏—á–æ

    spawn - —Å–ø–∞–≤–Ω–∏—Ç –æ–±—ä–µ–∫—Ç—ã, —ç—Ç–æ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü–µ, —Ç–∞–∫ –∏ –Ω–∞ –∫–∏—Ä—Ä–∏–ª–∏—Ü–µ)
    –≤—Ç–æ—Ä—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç rectangle (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫) –∏–ª–∏ oval (–æ–≤–∞–ª)
    —Ç—Ä–µ—Ç–∏–º –±—É–¥–µ—Ç x –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
    —á–µ—Ç–≤–µ—Ä—Ç—ã–º –±—É–¥–µ—Ç y –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
    –ø—è—Ç—ã–º –±—É–¥–µ—Ç x –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏
    —à–µ—Å—Ç—ã–º –±—É–¥–µ—Ç y –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏
    –∏ —Å–µ–¥—å–º—ã–º –±—É–¥–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä blue) –∏–ª–∏ html –∫–æ–¥ —Ü–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä #010101)
    –∏ –≥–ª–∞–≤–Ω–æ–µ! –ù–ï –ù–ê–ó–´–í–ê–ô –æ–±—ä–µ–∫—Ç background, —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É.
    –ø—Ä–∏–º–µ—Ä:
    spawn –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ rectangle 100 100 200 200 green
    
    —Å–ª–µ–¥—É–π —Å—Ç—Ä–æ–≥–æ —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –µ—Å–ª–∏ –Ω–µ –Ω–∞–ø–∏—à–µ—à—å –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–ø—Ä–∏–º–µ—Ä

    edit - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —Ç–æ–∂–µ —Å–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞
    –≤—Ç–æ—Ä—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç color, nickname –∏–ª–∏ action
    –µ—Å–ª–∏ –æ–Ω –±—É–¥–µ—Ç color, —Ç–æ —Ç—Ä–µ—Ç–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä blue) –∏–ª–∏ html –∫–æ–¥ —Ü–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä #010101)
    –µ—Å–ª–∏ –µ—â–µ background –±—É–¥–µ—Ç –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º, —Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Ü–≤–µ—Ç —Ñ–æ–Ω–∞

    –µ—Å–ª–∏ –æ–Ω –±—É–¥–µ—Ç nickname (–Ω–∞–¥–ø–∏—Å—å —Å–≤–µ—Ä—Ö—É, —Å–ª—É–∂–∏—Ç –ø—É–±–ª–∏—á–Ω—ã–º –∏–º–µ–Ω–µ–º) –∏–ª–∏ action (–Ω–∞–¥–ø–∏—Å—å —Å–Ω–∏–∑—É, —Å–ª—É–∂–∏—Ç –¥–µ–π—Å—Ç–≤–∏—é –∏–ª–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä—É), —Ç–æ —Ç—Ä–µ—Ç–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç —Ç–µ–∫—Å—Ç
    –ø—Ä–∏–º–µ—Ä:
    edit –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ color red
    edit –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ nickname –∏—á–æ
    edit background color red

    move - –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –º–µ–Ω–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞
    –≤—Ç–æ—Ä—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç –Ω–∞ —Å–∫–æ–ª—å–∫–æ x –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è
    —Ç—Ä–µ—Ç–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç –Ω–∞ —Å–∫–æ–ª—å–∫–æ y –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è
    –ø—Ä–∏–º–µ—Ä:
    move –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ 10 0 (–ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –Ω–∞ 10 –ø–∏–∫—Å–µ–ª–µ–π –Ω–∞–ø—Ä–∞–≤–æ)

    delete (–Ω–∞–∑–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞) - —É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã

    –µ—Å–ª–∏ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –æ–¥–Ω–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–∞—è –≤—ã—à–µ, —Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É

    –ø—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –∫–æ–¥–∞:

    sleep 1
    title –∏—á–æ
    rem –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
    sleep 1
    title –î–∞ –í–µ–Ω–µ—Ä—Å–∫–∏–π –û–Ω –í—Å–µ–≥–¥–∞ –ò –ë—É–¥–µ—Ç –ü–µ—Ä–µ–æ–±—É–≤—â–∏–∫.
    sleep 1
    spawn –ª–æ—Ö rectangle 300 300 500 500 white

    edit –ª–æ—Ö color blue
    edit –ª–æ—Ö nickname –í–µ–Ω–µ—Ä—Å–∫–∏–π –∏—á–æ.
    edit –ª–æ—Ö action // –∏—á–æ–∫–∞–µ—Ç

    sleep 1
    delete –ª–æ—Ö

    –í—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–ª–æ—â–∞–¥–∏ 1280 –ø–∏–∫—Å–µ–ª–µ–π –ø–æ x –∏ 720 –ø–æ y

    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è sleep - 1 —Å–µ–∫—É–Ω–¥–∞

    –ü–û–ú–ù–ò! TITLE –£–î–ê–õ–Ø–ï–¢ –í–°–ï –û–ë–™–ï–ö–¢–´, –ï–°–õ–ò –¢–´ –ü–û–ü–´–¢–ê–ï–®–¨–°–Ø –í–ó–Ø–¢–¨ –ù–ê–ü–†–ò–ú–ï–† –ö–£–ë, –¢–û –ò–ù–¢–ï–†–ü–†–ï–¢–ê–¢–û–† –í–´–î–ê–°–¢ KEYERROR

    –ï–©–ï –ù–ò–ß–ï–ì–û –ù–ï –í–´–í–û–î–ò –ö–†–û–ú–ï –ö–û–î–ê
    
    –ù–∞–∑–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä –í–µ–Ω–µ—Ä—Å–∫–∏–π) –∏–ª–∏ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ _ (–Ω–∞–ø—Ä–∏–º–µ—Ä –í–µ–Ω–µ—Ä—Å–∫–∏–π_–∏—á–æ)
    —É–¥–∞—á–∏ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ–∏–ª—å–º–æ–≤!"""
    try:
        llm = Llama(model_path=path, n_ctx=2048, verbose=True)
        a = llm.create_chat_completion(
            messages=[{"role": "user", "content": instruction}, {"role": "user", "content": f"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ñ–∏–ª—å–º —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é (–ü–û–ñ–ê–õ–£–ô–°–¢–ê, –ù–ï –ó–ê–ë–´–í–ê–ô –£–ö–ê–ó–´–í–ê–¢–¨ –ù–ê–ó–í–ê–ù–ò–Ø –ü–û–°–õ–ï SPAWN, –¢–û–õ–¨–ö–û –ü–û–¢–û–ú –£–ö–ê–ó–´–í–ê–ô RECTANGLE –ò–õ–ò OVAL):{p}"}],
            temperature=0.7,
        )
        print(a["choices"][0]["message"]["content"])

    except Exception as e:
        showerror(title="–û—à–∏–±–∫–∞ –æ—Ç Python –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏", message=e)
        return
    try:
        text["text"] = "–ì–æ—Ç–æ–≤–æ!\n–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞..."
        generation_window.update()
        num = randint(1, 100000)
        with open(f"{num}.üñï", "w", errors="ignore", encoding="utf-8") as file:
            file.write(a["choices"][0]["message"]["content"])
    except Exception as e:
        showerror(title="–û—à–∏–±–∫–∞, –≤–æ–∑–º–æ–∂–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–∞—è, –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞", message=e)
        return
    # system(f"python interpreter.py {num}.üñï")
    film_player_window = tk.Toplevel(root)
    film_player = FilmPlayer(film_player_window)
    try:
        with open(f"{num}.üñï", "r", errors="ignore", encoding="utf-8") as file:
            film_player.process_line(index=0, content=file.readlines())
    except:
        showwarning(title="–ü—Ä–æ–∏–∑–æ—à–ª–∞ –ø–∞—Ä–∞—à–∫–∞", message="–ù–µ–π—Ä–æ—Å–µ—Ç—å –¥–æ–ª–∂–Ω–∞ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥")
        try:
            llm = Llama(model_path=path, n_ctx=2048, verbose=True)
            text["text"] = "–ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.\n–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç."
            generation_window.update()
            a = llm.create_chat_completion(
                messages=[{"role": "user", "content": instruction}, {"role": "user",
                                                                       "content": f"–ò—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫–∏ –≤ —ç—Ç–æ–º –∫–æ–¥–µ –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—ã—à–µ, —É–∫–∞–∂–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ spawn –∏ –ø–µ—Ä–µ–¥ rectangle –∏–ª–∏ oval. –ö–æ–¥ —Å–ª–µ–¥—É—é—â–∏–π: {a["choices"][0]["message"]["content"]}"}],
                temperature=0.7,
            )
            text["text"] = "–ì–æ—Ç–æ–≤–æ!\n–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞..."
            generation_window.update()
            with open(f"{num}.üñï", "w", errors="ignore", encoding="utf-8") as file:
                file.write(a["choices"][0]["message"]["content"])
            with open(f"{num}.üñï", "r", errors="ignore", encoding="utf-8") as file:
                film_player.process_line(index=0, content=file.readlines())
        except Exception as e:
            showerror(title="–ü—Ä–æ–≤–∞–ª.", message=e)
            return
root = Tk()
root.iconbitmap(r'Fakefilms_icon.ico')
root.title("Fakefilms")
root.geometry("400x300")
root.grid_columnconfigure(0, weight=1)
root.grid_rowconfigure(0, weight=1)
root.resizable(False, False)
editor = Text()
editor.grid()
btn = ttk.Button(text="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å", command=start)
btn.grid(row=1, column=0, sticky='sw')
btn = ttk.Button(text="–ó–∞–¥–∞—Ç—å –ø—É—Ç—å –∫ gguf —Ñ–∞–π–ª—É", command=select_file)
btn.grid(row=1, column=0, sticky='se')
root.mainloop()